\section{Position Context Provider}
\label{sec:design:position-context-provider}

The following section describes the position context provider introduced in \cref{sec:analysis:context-engine}.

The position context provider is responsible for determining which actions it makes sense to trigger in the users current position and what the probability of the user desiring to trigger each of the actions.

The context provider determines the position of the user using Bluetooth LE. One or more Estimote beacons are installed in rooms that should be tracked. The beacons broadcast using the Eddystone protocol as described in section \ref{sec:design:ble-positioning}. The wearable continuously scans for nearby beacons using the Estimote SDK.

The Estimote delivers a set of discovered beacons several times each second. Each time beacons are discovered, the provider choose the beacon with the highest RSSI. We assume that the higher the RSSI is, the closer the user is to the beacon as the RSSI is an indicator of the signal strength between the two Bluetooth devices.

In order to account for sporadic and false measurements indicating that the user is in the wrong room, we store a reference to the room the beacon with the highest RSSI is placed in. Each reference lives in the queue for 30 seconds. \todo[author=Simon]{Inds√¶t reference til hvorfor vi bruger 30 sekunder} Whenever the context provider is asked to provide its context, we calculate the occurence of each beacon in percentage.

For example, consider the following set where $A$, $B$ and $C$ are different rooms.

\begin{equation*}
  \{ A, A, B, B, A, A, A, B, C, A, A, A \}
\end{equation*}

There are a total of twelve items in the queue. Room A occurs eight times, Room B occurs three times and Room C occurs one time. Therefore we assign a 66.67\% probability that the user is in Room A, a 25\% probability that the user is in Room B and a roughly 8.33\% probability that the user is in Room C.

For each room we find the actions that are valid in the room and distribute the probabilities on all actions. Consider the valid actions for each room in \Cref{tbl:sec:design:position-context-provider:actions}.

\begin{table}[h!]
\centering
\caption{Example of actions available in room A, B and C.}
\label{tbl:sec:design:position-context-provider:actions}
\begin{tabular}{llll}
                 & \textbf{Room A} & \textbf{Room B} & \textbf{Room C} \\
\textbf{Actions} & 1, 2            & 3, 4, 5         & 6   
\end{tabular}
\end{table}

We assign a weight of 66.67 to the actions in room A, a weight of 25 to the actions in room B and a weight of 8.33 to the actions in room C and normalize the weights as shown in \Cref{tbl:sec:design:position-context-provider:weighted-actions}. The normalized weights are returned as outcomes by the context provider.

\begin{table}[h!]
\centering
\caption{Example of weights assigned to actions.}
\label{tbl:sec:design:position-context-provider:weighted-actions}
\begin{tabular}{lll}
                  & \textbf{Weight} & \textbf{Normalized weight} \\
\textbf{Action 1} & 66.67              & $\frac{66.67}{216.67}$                   \\
\textbf{Action 2} & 66.67              & $\frac{66.67}{216.67}$                   \\
\textbf{Action 3} & 25              & $\frac{25}{216.67}$                   \\
\textbf{Action 4} & 25              & $\frac{25}{216.67}$                   \\
\textbf{Action 5} & 25              & $\frac{25}{216.67}$                   \\
\textbf{Action 6} & 8.33               & $\frac{8.33}{216.67}$                    \\
\textbf{Total}    & 216.67             & 1                         
\end{tabular}
\end{table}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../master"
%%% End:
